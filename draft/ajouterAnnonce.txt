// fichier indexé - ajout direct - CP: fa_cle - CSAD: fa_cle, fa_lieu_rdv
procedure ajouterAnnonce(E/S fannonce: Fannonce, E frajet: Ftrajet)
variables
    cr_fannonce : cdc
    tamp_fannonce : Tannonce
    
debut
    ecrire("|| PUBLIER UNE NOUVELLE ANNONCE ||")

    repeter
        ecrire('Veuillez saisir votre date de départ :')
        lire(tamp_fannonce.fa_date_dep)
    jusqu a (tamp_fannonce.fa_date_dep > date())

    repeter
        ecrire('Veuillez saisir votre point de départ :')
        lire(tamp_fannonce.fa_cle.ftra_pointdepart)
        ecrire('Veuillez saisir votre destination :')
        lire(tamp_fannonce.fa_cle.ftra_pointarrive)
    jusqu a (existeTrajet(ftrajet, tamp_fannonce.fa_cle.ftra_pointdepart, tamp_fannonce.fa_cle.ftra_pointarrive))

    repeter
        ecrire('Veuillez saisir un lieu de rendez-vous :')
        lire(tamp_fannonce.fa_lieu_rdv)
    jusqu a (tamp_fannonce.fa_lieu_rdv <> '')

    repeter
        ecrire('Veuillez saisir le nombre de voyageurs souhaité :')
        lire(tamp_fannonce.fa_place_max)
    jusqu a (tamp_fannonce.fa_place_max >= 1 et tamp_fannonce.fa_place_max <= 4)

    repeter
        ecrire('Veuillez saisir le prix du voyage :')
        lire(tamp_fannonce.fa_prix)
    jusqu a (tamp_fannonce.fa_prix >= 0)

    ouvrir(fannonce, <<mise-a-jour>>, cr_fannonce)
    ecrireDir(fannonce, tamp_fannonce, cr_fannonce)
    fermer(fannonce, cr_fannonce)

fin

// fichier indexé - CP: ftra_cle -> recherche directe
fonction existeTrajet(E ftrajet : Ftrajet, E depart : cdc, E arrive : cdc) : booleen
variables
    tamp_ftrajet : Ttrajet
    cr_ftrajet : cdc
    existe : booleen
    reponse : caractere

debut
    ouvrir(ftrajet, <<lecture>>, cr_ftrajet)
    tamp_ftrajet.ftra_cle.ftra_pointdepart <- depart
    tamp_ftrajet.ftra_cle.ftra_pointarrive <- arrive
    lireDir(ftrajet, tamp_ftrajet, cr_ftrajet)
    si (cr_ftrajet = 'OK') alors
        existe = vrai
    sinon
        repeter
            ecrire('Trajet inexistant. Voulez-vous créer un nouveau trajet ? O/N')
            lire(reponse)
            si (reponse = 'O') alors
                existe = vrai
            sinon si (reponse = 'N') alors
                existe = faux
            fin si
        jusqu'a (reponse = 'O' ou reponse = 'N')
    fin si
    fermer(ftrajet, cr_ftrajet)
    si (reponse = 'O') alors
        ouvrir(ftrajet, <<mise-a-jour>>, cr_ftrajet)
        ecrireDir(ftrajet, tamp_ftrajet, cr_ftrajet)
        fermer(ftrajet, cr_ftrajet)
    fin si
    retourner existe
fin